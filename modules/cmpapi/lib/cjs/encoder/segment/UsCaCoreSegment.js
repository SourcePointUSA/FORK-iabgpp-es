"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UsCaCoreSegment=void 0;const CompressedBase64UrlEncoder_js_1=require("../base64/CompressedBase64UrlEncoder.js"),BitStringEncoder_js_1=require("../bitstring/BitStringEncoder.js"),EncodableFixedInteger_js_1=require("../datatype/EncodableFixedInteger.js"),EncodableFixedIntegerList_js_1=require("../datatype/EncodableFixedIntegerList.js"),DecodingError_js_1=require("../error/DecodingError.js"),ValidationError_js_1=require("../error/ValidationError.js"),EncodableBitStringFields_js_1=require("../field/EncodableBitStringFields.js"),UsCaField_js_1=require("../field/UsCaField.js"),UsCaField_js_2=require("../field/UsCaField.js"),UsCa_js_1=require("../section/UsCa.js"),AbstractLazilyEncodableSegment_js_1=require("./AbstractLazilyEncodableSegment.js");class UsCaCoreSegment extends AbstractLazilyEncodableSegment_js_1.AbstractLazilyEncodableSegment{constructor(e){super(),this.base64UrlEncoder=CompressedBase64UrlEncoder_js_1.CompressedBase64UrlEncoder.getInstance(),this.bitStringEncoder=BitStringEncoder_js_1.BitStringEncoder.getInstance(),e&&this.decode(e)}getFieldNames(){return UsCaField_js_1.USCA_CORE_SEGMENT_FIELD_NAMES}initializeFields(){const e=new class{test(e){return e>=0&&e<=2}},i=new class{test(e){return e>=1&&e<=2}},t=new class{test(e){for(let i=0;i<e.length;i++){let t=e[i];if(t<0||t>2)return!1}return!0}};let r=new EncodableBitStringFields_js_1.EncodableBitStringFields;return r.put(UsCaField_js_2.UsCaField.VERSION.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(6,UsCa_js_1.UsCa.VERSION)),r.put(UsCaField_js_2.UsCaField.SALE_OPT_OUT_NOTICE.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,0).withValidator(e)),r.put(UsCaField_js_2.UsCaField.SHARING_OPT_OUT_NOTICE.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,0).withValidator(e)),r.put(UsCaField_js_2.UsCaField.SENSITIVE_DATA_LIMIT_USE_NOTICE.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,0).withValidator(e)),r.put(UsCaField_js_2.UsCaField.SALE_OPT_OUT.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,0).withValidator(e)),r.put(UsCaField_js_2.UsCaField.SHARING_OPT_OUT.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,0).withValidator(e)),r.put(UsCaField_js_2.UsCaField.SENSITIVE_DATA_PROCESSING.toString(),new EncodableFixedIntegerList_js_1.EncodableFixedIntegerList(2,[0,0,0,0,0,0,0,0,0]).withValidator(t)),r.put(UsCaField_js_2.UsCaField.KNOWN_CHILD_SENSITIVE_DATA_CONSENTS.toString(),new EncodableFixedIntegerList_js_1.EncodableFixedIntegerList(2,[0,0]).withValidator(t)),r.put(UsCaField_js_2.UsCaField.PERSONAL_DATA_CONSENTS.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,0).withValidator(e)),r.put(UsCaField_js_2.UsCaField.MSPA_COVERED_TRANSACTION.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,1).withValidator(i)),r.put(UsCaField_js_2.UsCaField.MSPA_OPT_OUT_OPTION_MODE.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,0).withValidator(e)),r.put(UsCaField_js_2.UsCaField.MSPA_SERVICE_PROVIDER_MODE.toString(),new EncodableFixedInteger_js_1.EncodableFixedInteger(2,0).withValidator(e)),r}encodeSegment(e){let i=this.bitStringEncoder.encode(e,this.getFieldNames());return this.base64UrlEncoder.encode(i)}decodeSegment(e,i){null!=e&&0!==e.length||this.fields.reset(i);try{let t=this.base64UrlEncoder.decode(e);this.bitStringEncoder.decode(t,this.getFieldNames(),i)}catch(i){throw new DecodingError_js_1.DecodingError("Unable to decode UsCaCoreSegment '"+e+"'")}}validate(){let e=this.fields.get(UsCaField_js_2.UsCaField.SHARING_OPT_OUT_NOTICE).getValue(),i=this.fields.get(UsCaField_js_2.UsCaField.SHARING_OPT_OUT).getValue(),t=this.fields.get(UsCaField_js_2.UsCaField.SALE_OPT_OUT_NOTICE).getValue(),r=this.fields.get(UsCaField_js_2.UsCaField.SALE_OPT_OUT).getValue(),a=this.fields.get(UsCaField_js_2.UsCaField.MSPA_SERVICE_PROVIDER_MODE).getValue(),o=this.fields.get(UsCaField_js_2.UsCaField.MSPA_OPT_OUT_OPTION_MODE).getValue(),n=this.fields.get(UsCaField_js_2.UsCaField.SENSITIVE_DATA_LIMIT_USE_NOTICE).getValue();if(0==e){if(0!=i)throw new ValidationError_js_1.ValidationError("Invalid usca sharing notice / opt out combination: {"+e+" / "+i+"}")}else if(1==e){if(1!=i&&2!=i)throw new ValidationError_js_1.ValidationError("Invalid usca sharing notice / opt out combination: {"+e+" / "+i+"}")}else if(2==e&&1!=i)throw new ValidationError_js_1.ValidationError("Invalid usca sharing notice / opt out combination: {"+e+" / "+i+"}");if(0==t){if(0!=r)throw new ValidationError_js_1.ValidationError("Invalid usca sale notice / opt out combination: {"+t+" / "+r+"}")}else if(1==t){if(1!=r&&2!=r)throw new ValidationError_js_1.ValidationError("Invalid usca sale notice / opt out combination: {"+t+" / "+r+"}")}else if(2==t&&1!=r)throw new ValidationError_js_1.ValidationError("Invalid usca sale notice / opt out combination: {"+t+" / "+r+"}");if(0==a){if(0!=t)throw new ValidationError_js_1.ValidationError("Invalid usca mspa service provider mode / sale opt out notice combination: {"+a+" / "+t+"}");if(0!=e)throw new ValidationError_js_1.ValidationError("Invalid usca mspa service provider mode / sharing opt out notice combination: {"+a+" / "+e+"}");if(0!=n)throw new ValidationError_js_1.ValidationError("Invalid usca mspa service provider mode / sensitive data limit use notice combination: {"+a+" / "+n+"}")}else if(1==a){if(2!=o)throw new ValidationError_js_1.ValidationError("Invalid usca mspa service provider / opt out option modes combination: {"+a+" / "+a+"}");if(0!=t)throw new ValidationError_js_1.ValidationError("Invalid usca mspa service provider mode / sale opt out notice combination: {"+a+" / "+t+"}");if(0!=e)throw new ValidationError_js_1.ValidationError("Invalid usca mspa service provider mode / sharing opt out notice combination: {"+a+" / "+e+"}");if(0!=n)throw new ValidationError_js_1.ValidationError("Invalid usca mspa service provider mode / sensitive data limit use notice combination: {"+a+" / "+n+"}")}else if(2==a&&1!=o)throw new ValidationError_js_1.ValidationError("Invalid usca mspa service provider / opt out option modes combination: {"+a+" / "+o+"}")}}exports.UsCaCoreSegment=UsCaCoreSegment;